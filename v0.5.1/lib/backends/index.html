<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>NLP blocks and backends · ProxAL.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ProxAL.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../man/formulation/">Formulation</a></li><li><a class="tocitem" href="../../man/algorithm/">Algorithm</a></li><li><a class="tocitem" href="../../man/usage/">Usage</a></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../modelparams/">Model parameters</a></li><li><a class="tocitem" href="../algparams/">Algorithm parameters</a></li><li><a class="tocitem" href="../algorithm/">Main functions</a></li><li class="is-active"><a class="tocitem" href>NLP blocks and backends</a><ul class="internal"><li><a class="tocitem" href="#NLP-Blocks"><span>NLP Blocks</span></a></li><li><a class="tocitem" href="#Backends"><span>Backends</span></a></li><li><a class="tocitem" href="#OPF"><span>OPF</span></a></li></ul></li><li><a class="tocitem" href="../opf/">Optimal Power Flow</a></li><li><a class="tocitem" href="../mpi/">MPI communication</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Library</a></li><li class="is-active"><a href>NLP blocks and backends</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>NLP blocks and backends</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/exanauts/ProxAL.jl/blob/master/docs/src/lib/backends.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="NLP-blocks-and-backends"><a class="docs-heading-anchor" href="#NLP-blocks-and-backends">NLP blocks and backends</a><a id="NLP-blocks-and-backends-1"></a><a class="docs-heading-anchor-permalink" href="#NLP-blocks-and-backends" title="Permalink"></a></h1><h2 id="NLP-Blocks"><a class="docs-heading-anchor" href="#NLP-Blocks">NLP Blocks</a><a id="NLP-Blocks-1"></a><a class="docs-heading-anchor-permalink" href="#NLP-Blocks" title="Permalink"></a></h2><p>The <a href="../../man/formulation/#Formulation">Formulation</a> is decomposed into smaller nonlinear programming (NLP) blocks. Blocks are coupled together using a <code>OPFBlocks</code> structure.</p><article class="docstring"><header><a class="docstring-binding" id="ProxAL.OPFBlocks" href="#ProxAL.OPFBlocks"><code>ProxAL.OPFBlocks</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">OPFBlocks(
    opfdata::OPFData,
    rawdata::RawData;
    modelinfo::ModelInfo = ModelInfo(),
    backend=JuMPBlockBackend,
    algparams::AlgParams = AlgParams()
)</code></pre><p>Create a structure <code>OPFBlocks</code> to decompose the original OPF problem specified in <code>opfdata</code> timestep by timestep, by dualizing the ramping constraint. One block corresponds to one optimization subproblem (and hence, to a particular timestep), and the attribute <code>blkCount</code> enumerates the total number of subproblems. The subproblems are specified using <code>AbstractBlockModel</code> objects, allowing to define them either with JuMP (if <code>backend=JuMPBlockBackend</code> is chosen) or with ExaPF (<code>backend=ExaBlockBackend</code>).</p><p><strong>Decomposition by contingencies</strong></p><p>By default, OPFBlocks decomposes the problem only timestep by timestep (single-period multiple-contingency scheme), leading to a total of <code>T</code> subproblems. However, if the option <code>algparams.decompCtgs</code> is set to <code>true</code>, the original problem is also decomposed contingency by contingency (single-period single-contingency scheme). In this case the total number of subproblems is <code>T * K</code> (with <code>K</code> the total number of contingencies).</p><p><strong>Deporting the resolution on the GPU</strong></p><p>When the backend is set to <code>ExaBlockBackend</code> (and a CUDA GPU is available), the user could chose to deport the resolution of each subproblem directly on the GPU simply by setting <code>algparams.device=CUDADevice</code>. However, note that we could not instantiate more subproblems on the GPU than the number of GPU available.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/exanauts/ProxAL.jl/blob/72189e2a351048ecaaf063a3b4abd9a669b2f4be/src/blocks.jl#L1-L40">source</a></section></article><p>Internally, each block is represented as follows.</p><article class="docstring"><header><a class="docstring-binding" id="ProxAL.AbstractBlockModel" href="#ProxAL.AbstractBlockModel"><code>ProxAL.AbstractBlockModel</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AbstractBlockModel</code></pre><p>Abstract supertype for the definition of block subproblems.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/exanauts/ProxAL.jl/blob/72189e2a351048ecaaf063a3b4abd9a669b2f4be/src/backends.jl#L23-L27">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ProxAL.init!" href="#ProxAL.init!"><code>ProxAL.init!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">init!(block::AbstractBlockModel, algparams::AlgParams)</code></pre><p>Initialize the optimization model by populating the model with variables and constraints.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/exanauts/ProxAL.jl/blob/72189e2a351048ecaaf063a3b4abd9a669b2f4be/src/backends.jl#L30-L36">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ProxAL.add_variables!" href="#ProxAL.add_variables!"><code>ProxAL.add_variables!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">add_variables!(block::AbstractBlockModel, algparams::AlgParams)</code></pre><p>Add all optimization variables into the decomposed optimization model <code>block</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/exanauts/ProxAL.jl/blob/72189e2a351048ecaaf063a3b4abd9a669b2f4be/src/backends.jl#L86-L92">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ProxAL.set_objective!" href="#ProxAL.set_objective!"><code>ProxAL.set_objective!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">set_objective!(
    block::AbstractBlockModel,
    algparams::AlgParams,
    primal::AbstractPrimalSolution,
    dual::AbstractDualSolution
)</code></pre><p>Update the objective inside <code>block</code>&#39;s optimization subproblem. The new objective updates the coefficients of the penalty terms with respect to the reference <code>primal</code> and <code>dual</code> solutions passed in the arguments.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/exanauts/ProxAL.jl/blob/72189e2a351048ecaaf063a3b4abd9a669b2f4be/src/backends.jl#L69-L82">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ProxAL.optimize!" href="#ProxAL.optimize!"><code>ProxAL.optimize!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">optimize!(block::AbstractBlockModel, x0::AbstractArray, algparams::AlgParams)</code></pre><p>Solve the optimization problem, starting from an initial point <code>x0</code>. The optimization solver is specified in field <code>algparams.optimizer</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/exanauts/ProxAL.jl/blob/72189e2a351048ecaaf063a3b4abd9a669b2f4be/src/backends.jl#L39-L46">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ProxAL.set_start_values!" href="#ProxAL.set_start_values!"><code>ProxAL.set_start_values!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">set_start_values!(block::AbstractBlockModel, x0::AbstractArray)</code></pre><p>Set <code>x0</code> as the initial point for the optimization of model <code>block</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/exanauts/ProxAL.jl/blob/72189e2a351048ecaaf063a3b4abd9a669b2f4be/src/backends.jl#L96-L102">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ProxAL.get_solution" href="#ProxAL.get_solution"><code>ProxAL.get_solution</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">get_solution(block::AbstractBlockModel, output)</code></pre><p>Return the solution of the optimization as a named tuple <code>solution</code>, with fields</p><ul><li><code>status::MOI.TerminationStatus</code>: final status returned by the solver</li><li><code>minimum::Float64</code>: optimal objective found</li><li><code>vm::AbstractArray</code>: optimal values of voltage magnitudes</li><li><code>va::AbstractArray</code>: optimal values of voltage angles</li><li><code>pg::AbstractArray</code>: optimal values of active power generations</li><li><code>qg::AbstractArray</code>: optimal values of reactive power generations</li><li><code>ωt::AbstractArray</code>: optimal values of frequency variable</li><li><code>st::AbstractArray</code>: optimal values of slack variables for ramping</li><li><code>sk::AbstractArray</code>: optimal values of slack variables for contingencies (OPTIONAL)</li><li><code>zk::AbstractArray</code>: optimal values of penalty variables for contingencies (OPTIONAL)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/exanauts/ProxAL.jl/blob/72189e2a351048ecaaf063a3b4abd9a669b2f4be/src/backends.jl#L49-L65">source</a></section></article><h2 id="Backends"><a class="docs-heading-anchor" href="#Backends">Backends</a><a id="Backends-1"></a><a class="docs-heading-anchor-permalink" href="#Backends" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="ProxAL.JuMPBackend" href="#ProxAL.JuMPBackend"><code>ProxAL.JuMPBackend</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">JuMPBackend &lt;: AbstractBackend</code></pre><p>Solve OPF in full-space with JuMP/MOI.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/exanauts/ProxAL.jl/blob/72189e2a351048ecaaf063a3b4abd9a669b2f4be/src/backends.jl#L8-L12">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ProxAL.JuMPBlockBackend" href="#ProxAL.JuMPBlockBackend"><code>ProxAL.JuMPBlockBackend</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">JuMPBlockBackend(
    blk::Int,
    opfdata::OPFData,
    raw_data::RawData,
    algparams::AlgParams,
    modelinfo::ModelInfo,
    t::Int, k::Int, T::Int,
)</code></pre><p>Use the JuMP backend to define the optimal power flow inside the block model. This function is called inside the constructor of the structure <code>OPFBlocks</code>.</p><p><strong>Arguments</strong></p><ul><li><code>blk::Int</code>: ID of the block represented by this model</li><li><code>opfdata::OPFData</code>: data used to build the optimal power flow problem.</li><li><code>raw_data::RawData</code>: same data, in raw format</li><li><code>algparams::AlgParams</code>: algorithm parameters</li><li><code>modelinfo::ModelInfo</code>: model parameters</li><li><code>t::Int</code>: current time period index. Value should be between <code>1</code> and <code>T</code>.</li><li><code>k::Int</code>: current contingency index</li><li><code>T::Int</code>: final time period index</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/exanauts/ProxAL.jl/blob/72189e2a351048ecaaf063a3b4abd9a669b2f4be/src/backends.jl#L128-L154">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ProxAL.AdmmBackend" href="#ProxAL.AdmmBackend"><code>ProxAL.AdmmBackend</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ExaAdmmBackend &lt;: AbstractBackend</code></pre><p>Solve OPF by decomposition using ExaAdmm.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/exanauts/ProxAL.jl/blob/72189e2a351048ecaaf063a3b4abd9a669b2f4be/src/backends.jl#L15-L19">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ProxAL.AdmmBlockBackend" href="#ProxAL.AdmmBlockBackend"><code>ProxAL.AdmmBlockBackend</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AdmmBlockBackend(
    blk::Int,
    opfdata::OPFData,
    raw_data::RawData,
    algparams::AlgParams,
    modelinfo::ModelInfo,
    t::Int, k::Int, T::Int;
)</code></pre><p><strong>Arguments</strong></p><ul><li><code>blk::Int</code>: ID of the block represented by this model</li><li><code>opfdata::OPFData</code>: data used to build the optimal power flow problem.</li><li><code>raw_data::RawData</code>: same data, in raw format</li><li><code>algparams::AlgParams</code>: algorithm parameters</li><li><code>modelinfo::ModelInfo</code>: model parameters</li><li><code>t::Int</code>: current time period index. Value should be between <code>1</code> and <code>T</code>.</li><li><code>k::Int</code>: current contingency index</li><li><code>T::Int</code>: final time period index</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/exanauts/ProxAL.jl/blob/72189e2a351048ecaaf063a3b4abd9a669b2f4be/src/backends.jl#L572-L594">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ProxAL.ExaPFBackend" href="#ProxAL.ExaPFBackend"><code>ProxAL.ExaPFBackend</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ExaPFBackend &lt;: AbstractBackend</code></pre><p>Solve OPF in reduced-space with ExaPF.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/exanauts/ProxAL.jl/blob/72189e2a351048ecaaf063a3b4abd9a669b2f4be/src/backends.jl#L1-L5">source</a></section></article><h2 id="OPF"><a class="docs-heading-anchor" href="#OPF">OPF</a><a id="OPF-1"></a><a class="docs-heading-anchor-permalink" href="#OPF" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="ProxAL.opf_block_get_auglag_penalty_expr" href="#ProxAL.opf_block_get_auglag_penalty_expr"><code>ProxAL.opf_block_get_auglag_penalty_expr</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">opf_block_get_auglag_penalty_expr(
    opfmodel::JuMP.Model,
    modelinfo::ModelInfo,
    opfdata::OPFData,
    k::Int, t::Int,
    algparams::AlgParams,
    primal::OPFPrimalSolution,
    dual::OPFDualSolution
)</code></pre><p>Let <code>k</code> and <code>t</code> denote the contingency number and time period of the NLP <code>block</code>. Then, depending on <code>algparams.decompCtgs</code>, this function must return an appropriate expression.</p><p>We use <span>$\mathbb{I}[...]$</span> to denote the indicator function. Also, unless otherwise indicated, </p><ul><li><p><span>$z_g$</span> are parameters and must be taken from <code>primal.Zt</code></p></li><li><p><span>$p_g$</span> and <span>$s_g$</span> variables that are not indexed with <code>t</code>   are parameters and must be taken from <code>primal.Pg</code> and <code>primal.St</code></p></li><li><p><span>$\lambda$</span> (without <code>k</code> subscript) must be taken from <code>dual.ramping</code></p></li><li><p><span>$\rho_t$</span> must be taken from <code>algparams.ρ_t</code></p></li><li><p><span>$\tau$</span> must be taken from <code>algparams.τ</code></p></li><li><p>If <code>algparams.decompCtgs == false</code>, then this function must return:</p></li></ul><p class="math-container">\[\begin{aligned}
\sum_{g \in G} \Bigg\{
&amp; 0.5\tau [p^0_{g,t} - \mathrm{primal}.p^0_{g,t}]^2 \\
&amp;+\mathbb{I}[t &gt; 1]\Big(
\lambda_{gt}[p^0_{g,t-1} - p^0_{g,t} + s_{g,t} + z_{g,t} - r_g] +
0.5\rho_{t}[p^0_{g,t-1} - p^0_{g,t} + s_{g,t} + z_{g,t} - r_g]^2
\Big) \\
&amp;+\mathbb{I}[t &lt; T]\Big(
\lambda_{g,t+1}[p^0_{g,t} - p^0_{g,t+1} + s_{g,t+1} + z_{g,t+1} - r_g] +
0.5\rho_{t}[p^0_{g,t} - p^0_{g,t+1} + s_{g,t+1} + z_{g,t+1} - r_g]^2
\Big) \Bigg\}
\end{aligned}\]</p><ul><li>If <code>algparams.decompCtgs == true</code>, then this function must return:</li></ul><p>(to do)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/exanauts/ProxAL.jl/blob/72189e2a351048ecaaf063a3b4abd9a669b2f4be/src/OPF/opfmodel.jl#L863-L906">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../algorithm/">« Main functions</a><a class="docs-footer-nextpage" href="../opf/">Optimal Power Flow »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.19 on <span class="colophon-date" title="Sunday 12 June 2022 18:00">Sunday 12 June 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
